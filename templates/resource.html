{% extends "base.html" %}
{% load i18n %}

{% block head %}
<link rel='stylesheet' type='text/css' href='{{ STATIC_URL }}cal/fullcalendar.css' />
<link rel='stylesheet' type='text/css' href='{{ STATIC_URL }}cal/fullcalendar.print.css' media='print' />
<script type='text/javascript' src='{{ STATIC_URL }}cal/fullcalendar.js'></script>
<script>
    function onDayClick(date, allDay, jsEvent, view) {
	var theData = {};
	theData['timestamp'] = date.getTime()/1000;
	theData['resource_id'] = {{ resource.id }}
	$.ajax({
	    url: "{% url single_click_reservation %}",
	    type: "POST",
	    dataType: "json",
	    data: theData,
	    }).done(function() {
		$('#calendar').fullCalendar('refetchEvents');
	    }).fail(showAjaxFailure);
    }

    function onDragEvent(event, dayDelta, minuteDelta, allDay, revertFunc, jsEvent, ui, view){
	$('#calendar').fullCalendar('refetchEvents');
    }

    function deleteEvent(eventId) {
	n = noty({
	    text: "Do you want to remove event #" + eventId,
	    type: 'error',
	    dismissQueue: true,
	    layout: 'center',
	    buttons: [
	    {
		addClass: 'btn btn-danger', text: 'Delete', onClick: function($noty) {
		    $noty.close();
		    $.ajax({
			url: "{% url delete_reservation %}",
			type: "POST",
			dataType: "json",
			data: {id: eventId},
			}).done(function() {
			    $('#calendar').fullCalendar('refetchEvents');
			}).fail(showAjaxFailure);
		}
	    },
	    {
		addClass: 'btn btn-primary', text: 'Cancel', onClick: function($noty) {
		    $noty.close();
		    $('#calendar').fullCalendar('refetchEvents');
		}

	    }]
	});
    }

    function showEventInfo(calEvent) {
    }

    function onEventClick(calEvent, jsEvent, view) {
	if (calEvent.is_own) {
	    deleteEvent(calEvent.id);
	} else {
	    showEventInfo(calEvent);
	}
    }

    $(document).ready( function() {
	$('#calendar').fullCalendar({
	    firstDay: 1,
	    defaultView: 'agendaWeek',
	    editable: true,
	    disableResizing: true,
	    allDayDefault: false,
	    allDaySlot: false,
	    defaultEventMinutes: 60,
	    firstHour: 10,
	    columnFormat: 'ddd d/M',
	    titleFormat: {
		month: 'MMMM yyyy',                             // September 2009
		week: "MMM d[',' yyyy]{ '&#8212;'[ MMM] d',' yyyy}", // Sep 7 - 13 2009
		day: 'dddd, MMM d, yyyy'                  // Tuesday, Sep 8, 2009
	    },
	    eventSources: [{url: "{% url reservations resource.id %}"}],
	    dayClick: onDayClick,
	    eventClick: onEventClick
	})
    });
</script>
{% endblock %}

{% block content %}
In language {{ lang }}
Showing resource {{ resource.name }} with id {{ resource.id }}.
<div id="calendar"/>
    {% endblock %}
